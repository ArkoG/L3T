# Consommation stock mines de fer pour toutes les mines du monde d'un coup
character_event = {
	id = ECO.132
	hide_window = yes
	ai = no # Pour que l'event soit lever qu'une seule fois par an
	is_triggered_only = yes
	
	trigger = {
	#
	}
	
	immediate = {
		any_title = {
			limit = { 
				tier = baron
				holding_type = castle
				location = { 
					has_province_modifier = minerai2_fer
					#NOT = { has_province_modifier = mine_collapsed } # MODIFIER NOT DEFINED
					NOT = { has_province_flag = recharge_mine_encours }
					NOT = { has_province_modifier = mine_stop }
					}				
				}
				
		#conso de base	
			#la mine est niveau 1
			if = { 
				limit = {
					has_building = CA_MINE_minerai_L1
					NOT = {	has_building = CA_MINE_minerai_L2	}
					NOT = {	has_building = CA_MINE_minerai_L3	}
					}
			location = { province_event = { id = ECO.1391 days = 1 }}
			location = { change_variable = { which = "stock_minerai" value =  -10 }}
			}
			#la mine est niveau 2
			if = {
				limit = {			
					has_building = CA_MINE_minerai_L2
					NOT = {	has_building = CA_MINE_minerai_L3	}
					}
			location = { province_event = { id = ECO.1392 days = 1 }}
			location = { change_variable = { which = "stock_minerai" value =  -20 }}
			}
			#la mine est niveau 3
			if = {
				limit = {			
					has_building = CA_MINE_minerai_L3
					}
			location = { province_event = { id = ECO.1393 days = 1 }}
			location = { change_variable = { which = "stock_minerai" value =  -30 }}
			random_list = {
				5 = { location = { change_variable = { which = "balrog_point" value =  1 }}}
				95 = {}
				}
			}
			
		#adjonction effet productivite (cumulatif)	
			#conso ralentie
			if = {
				limit = {			
					location = { has_province_modifier = mine_productivite_moins }
					}
			location = { province_event = { id = ECO.1394 days = 1 }}
			location = { change_variable = { which = "stock_minerai" value =  5 }}
			}
			#conso majoree			
			if = {
				limit = {			
					location = { has_province_modifier = mine_productivite_plus }
					}
			location = { province_event = { id = ECO.1395 days = 1 }}
			location = { change_variable = { which = "stock_minerai" value =  -5 }}
			random_list = {
				10 = { location = { change_variable = { which = "balrog_point" value =  1 }}}
				90 = {}
				}
			}

		#Alerte1
			if = { 
				limit = {
					has_building = CA_MINE_minerai_L1
					NOT = {	has_building = CA_MINE_minerai_L2	}
					NOT = {	has_building = CA_MINE_minerai_L3	}
					NOT = { location = { check_variable = { which = "stock_minerai" value =  100 }}} #conso base*10ans
					NOT = { location = { has_province_flag = alerte_mine_1_recue }}
					}
			location = { province_event = { id = ECO.133 days = 1 }}
			location = { set_province_flag = alerte_mine_1_recue }
			}
			if = { 
				limit = {
					has_building = CA_MINE_minerai_L2
					NOT = {	has_building = CA_MINE_minerai_L3	}
					NOT = { location = { check_variable = { which = "stock_minerai" value =  200 }}} #conso base*10ans
					NOT = { location = { has_province_flag = alerte_mine_1_recue }}
				}
			location = { province_event = { id = ECO.133 days = 1 }}
			location = { set_province_flag = alerte_mine_1_recue }
			}
			if = { 
				limit = {
					has_building = CA_MINE_minerai_L3
					NOT = { location = { check_variable = { which = "stock_minerai" value =  300 }}} #conso base*10ans
					NOT = { location = { has_province_flag = alerte_mine_1_recue }}
				}
			location = { province_event = { id = ECO.133 days = 1 }}
			location = { set_province_flag = alerte_mine_1_recue }
			}
		#Alerte2
			if = { 
				limit = {
					has_building = CA_MINE_minerai_L1
					NOT = {	has_building = CA_MINE_minerai_L2	}
					NOT = {	has_building = CA_MINE_minerai_L3	}
					NOT = { location = { check_variable = { which = "stock_minerai" value =   50 }}} #conso base*5ans
					NOT = { location = { has_province_flag = alerte_mine_2_recue }}
				}
			location = { province_event = { id = ECO.134 days = 1 }}
			location = { set_province_flag = alerte_mine_2_recue }
			}
			if = { 
				limit = {
					has_building = CA_MINE_minerai_L2
					NOT = {	has_building = CA_MINE_minerai_L3	}
					NOT = { location = { check_variable = { which = "stock_minerai" value =  100 }}} #conso base*5ans
					NOT = { location = { has_province_flag = alerte_mine_2_recue }}
				}
			location = { province_event = { id = ECO.134 days = 1 }}
			location = { set_province_flag = alerte_mine_2_recue }
			}
			if = { 
				limit = {
					has_building = CA_MINE_minerai_L3
					NOT = { location = { check_variable = { which = "stock_minerai" value =  150 }}} #conso base*5ans
					NOT = { location = { has_province_flag = alerte_mine_2_recue }}
				}
			location = { province_event = { id = ECO.134 days = 1 }}
			location = { set_province_flag = alerte_mine_2_recue }
			}
		#arret de la mine
			if = { 
				limit = {
					NOT = { location = { check_variable = { which = "stock_minerai" value =  1 }}} # inférieur ou égal à 0
					#NOT = { location = { has_province_flag = recharge_mine_encours }}
				}
			location = { province_event = { id = ECO.135 days = 1 }}
			location = { add_province_modifier = { name = mine_stop duration = -1 } }
			}
		}
	}
}
#events alertes
province_event = { #10ans de stock
	id = ECO.133
	desc = "DESCECO.133"
	picture = GFX_evt_castle_construction	
	is_triggered_only = yes

	option = { 
		name = "ECO.133A"
	}
}
province_event = { #5ans de stock
	id = ECO.134
	desc = "DESCECO.134"
	picture = GFX_evt_castle_construction	
	is_triggered_only = yes

	option = { #débloquera décision en prio avec un flag
		name = "ECO.134A" #ajouter option pour lancer la décision directement ?
	}
}
province_event = { #stock à zéro
	id = ECO.135
	desc = "DESCECO.135"
	picture = GFX_evt_castle_construction	
	is_triggered_only = yes

	option = { 
		name = "ECO.135A" 
	}
}

# Close mines
province_event = {
	id = ECO.136
	desc = "DESCECO.136"
	picture = GFX_evt_castle_construction

	trigger = {
		has_province_modifier = mine_stop
		has_province_modifier = minerai1 # Be sure that we don't wait the disparition of the mine_stop modifier
		NOT = { owner = { has_character_flag = refused_closing_mine_ever } }
	}

	mean_time_to_happen = { 
		#months = 6
		days = 10
		modifier = { factor = 2	owner = { has_character_flag = refused_closing_mine } }
	}

	option = { 
		name = "ECO.136A"
		# Close the mines
		remove_province_modifier = minerai1
		custom_tooltip = { text = TOOLTIPECO136 }
		hidden_tooltip = { 
			any_province_holding = {
				if = {
					limit = { has_building = CA_MINE_minerai_L1}
					owner = { wealth = 35 }
					remove_building = CA_MINE_minerai_L1
				}
				if = {
					limit = { has_building = CA_MINE_minerai_L2}
					owner = { wealth = 53 }
					remove_building = CA_MINE_minerai_L2
				}
				if = {
					limit = { has_building = CA_MINE_minerai_L3}
					owner = { wealth = 100 }
					remove_building = CA_MINE_minerai_L3
				}
			}
		}
		
		# Give again resources if necessary
		hidden_tooltip = { subtract_variable = { which = "resourceNb" value = 1 } }
		province_event = { id = ECO.0015 days = 10 }
		
		# Remove the modifier
		province_event = { id = ECO.137 days = 180 }
	}
	
	option = { 
		name = "ECO.136B"
		custom_tooltip = { text = TOOLTIPECO136B }
		owner = { set_character_flag = refused_closing_mine_moment }
	}
	
	option = { 
		name = "ECO.136C"
		custom_tooltip = { text = TOOLTIPECO136C }
		owner = { set_character_flag = refused_closing_mine_ever }
	}
}

# Remove "stop_mine"
province_event = {
	id = ECO.137
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		remove_province_modifier = mine_stop
	}
}

#mouchards
province_event = {
	id = ECO.1391
	desc = "DESCECO.1391"
	picture = GFX_evt_castle_construction	
	is_triggered_only = yes
	option = { name = "OK" }
}
province_event = {
	id = ECO.1392
	desc = "DESCECO.1392"
	picture = GFX_evt_castle_construction	
	is_triggered_only = yes
	option = { name = "OK" }
}
province_event = {
	id = ECO.1393
	desc = "DESCECO.1393"
	picture = GFX_evt_castle_construction	
	is_triggered_only = yes
	option = { name = "OK" }
}
province_event = {
	id = ECO.1394
	desc = "DESCECO.1394"
	picture = GFX_evt_castle_construction	
	is_triggered_only = yes
	option = { name = "OK" }
}
province_event = {
	id = ECO.1395
	desc = "DESCECO.1395"
	picture = GFX_evt_castle_construction	
	is_triggered_only = yes
	option = { name = "OK" }
}