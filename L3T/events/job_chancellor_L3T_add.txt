#################################
#         L3T  par Arko         #
#################################

namespace = L3T

##############################
# CHANCELLOR
# JOB: action_fabricate_claims
##############################



#Chancellor is arrested... (informing the chancellor, guards are here, no choice)
character_event = {
	id = L3T.80
	#desc = "DESCL3T.80"
	picture = GFX_evt_prisoner_hf
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes

	#inform character he is caught, is banished, have to abandon job

	#desc for direct arrestation
	desc = {
		text = DESCL3T.80a
		trigger = { has_character_flag = CHL_captured_str8 }
	}

	#desc for arrestation after flee
	desc = {
		text = DESCL3T.80b
		trigger = { has_character_flag = CHL_captured_flee }
	}

	picture = GFX_evt_prisoner_hf

	immediate = {
		random_list = {
			1 = { set_character_flag = random_1 }
			1 = { set_character_flag = random_2 }
		}
	}
	
	option = {
		name = "L3T.80A"
		trigger = { has_character_flag = CHL_captured_str8 }
		#abandon job
		event_target:claim_chancellor = { cancel_job_action = action_fabricate_claims }
		event_target:claim_chancellor = {
			add_character_modifier = {
				name = tarnished_reputation
				duration = -1
			}
		}
		event_target:claim_liege =  { letter_event = { id = L3T.83 days = 5 }} #informe le lige du retour
		#inform noble about successful arrestation
		event_target:claim_noble = { letter_event = { id = L3T.84 } }
		
		set_character_flag = chancellor_claim_tarnished_reputation
		
		event_target:claim_noble = {
			opinion = {
				who = event_target:claim_chancellor
				name = he_attempted_fabricate_claim_chancellor_banned
				years = 99
			}
		}
	}
	option = {
		name = "L3T.80B"
		trigger = { has_character_flag = CHL_captured_flee }
		#abandon job
		event_target:claim_chancellor = { cancel_job_action = action_fabricate_claims }
		event_target:claim_chancellor = {
			add_character_modifier = {
				name = tarnished_reputation
				duration = -1
			}
		}
		event_target:claim_liege =  { letter_event = { id = L3T.83 days = 5 }} #informe le lige du retour
		#inform noble about successful arrestation
		event_target:claim_noble = { letter_event = { id = L3T.84 } }
		
		set_character_flag = chancellor_claim_tarnished_reputation
		
		event_target:claim_noble = {
			opinion = {
				who = event_target:claim_chancellor
				name = he_attempted_fabricate_claim_chancellor_banned
				years = 99
			}
		}
	}
}

#Chancellor heard about the arrestation attempt, choosing what to do
character_event = {
	id = L3T.81
	desc = "DESCL3T.81"
	picture = GFX_evt_spymaster
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = "L3T.81A"
		#try to flee
		ai_chance = {
			factor = 90
		}
		#to hide
		random_list = {
			75 = {
				#success but need to abandon job
				event_target:claim_chancellor = { 
					letter_event = { id = L3T.82 days = 5 } #informe du succès
					set_character_flag = CHL_fled
				}
			}
			25 = {
				#failed and was catched
				event_target:claim_chancellor = { 
					letter_event = { id = L3T.80 days = 5 } #informe du succès
					set_character_flag = CHL_captured_flee
				}
			}
		}
	}
	option = { #cela ne peut être vrai / c'est pour m'intimider
		name = "L3T.81B"
		#no worries
		ai_chance = {
			factor = 10
			#confident
			#idiot
		}
		#to hide
		#was catched
		character_event = { id = L3T.80 days = 5 random = 2 } #informe de l'échec
		set_character_flag = CHL_captured_flee
	}
}

# L3T.82 - Chancellor is informed he has fled but have to abandon job
letter_event = {
	id = L3T.82
	desc = "DESCL3T.82"
	picture = GFX_evt_death
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = "L3T.82A"
			#success but need to abandon job
			event_target:claim_chancellor = { 
				cancel_job_action = action_fabricate_claims

			}
			event_target:claim_chancellor = {
				add_character_modifier = {
					name = tarnished_reputation
					duration = -1
				}
			}
			event_target:claim_liege =  { letter_event = { id = L3T.83 days = 10 }} #informe le lige du retour
			#noble is informed about the flee
			event_target:claim_noble = { letter_event = { id = L3T.84 days = 5 } }
			#noble will hate me BTW
			event_target:claim_noble = {
				opinion = {
					who = event_target:claim_chancellor
					name = he_attempted_fabricate_claim_chancellor_banned
					years = 99
				}
			}

	}
}

# L3T.83 - liege is informed about the Chancellor's failure and return
letter_event = {
	id = L3T.83
	desc = "DESCL3T.83"
	picture = GFX_evt_death
	border = GFX_event_normal_frame_diplomacy

	#desc for direct arrestation
	desc = {
		text = DESCL3T.83a
		trigger = { event_target:claim_chancellor = { has_character_flag = CHL_captured_str8 }}
	}
	#desc for arrestation after flee
	desc = {
		text = DESCL3T.83b
		trigger = { event_target:claim_chancellor = { has_character_flag = CHL_captured_flee }}
	}
	#desc successful flee
	desc = {
		text = DESCL3T.84c
		trigger = { event_target:claim_chancellor = { has_character_flag = CHL_fled }}
	}	
	#desc after flee or NOT
#	event_target:claim_chancellor
#has_character_flag = CHL_captured_flee
#	event_target:claim_chancellor
#has_character_flag = CHL_captured_str8

	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = "L3T.83A"
		job_chancellor = {
			cancel_job_action = action_fabricate_claims
		}
		event_target:claim_chancellor = {
			add_character_modifier = {
				name = tarnished_reputation
				duration = -1
			}
		}
		opinion = {
			who = event_target:claim_chancellor
			name = opinion_failure_claim
			years = 5
		}
		clear_event_target = claim_noble
		clear_event_target = claim_chancellor
		clear_event_target = claim_liege
	}
}
# L3T.84 - Noble is informed that the arrestation attempt succeeded or failed
letter_event = {
	id = L3T.84
	desc = "DESCL3T.84"
	picture = GFX_evt_death
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes

	#desc for direct arrestation
	desc = {
		text = DESCL3T.84a
		trigger = { event_target:claim_chancellor = { has_character_flag = CHL_captured_str8 }}
	}
	#desc for arrestation after flee
	desc = {
		text = DESCL3T.84b
		trigger = { event_target:claim_chancellor = { has_character_flag = CHL_captured_flee }}
	}
	#desc successful flee
	desc = {
		text = DESCL3T.84c
		trigger = { event_target:claim_chancellor = { has_character_flag = CHL_fled }}
	}
	#desc after flee or NOT
#	event_target:claim_chancellor
#has_character_flag = CHL_captured_flee
#	event_target:claim_chancellor
#has_character_flag = CHL_captured_str8
#had feld
	
	immediate = {
		random_list = {
			1 = { set_character_flag = random_1 }
			1 = { set_character_flag = random_2 }
		}
	}

	option = {
		#great!
		name = "L3T.84A"
		trigger = { has_character_flag = random_1 }
		clr_character_flag = random_1
		#hidden_tooltip = { 
			

		#}
		opinion = {
			who = event_target:claim_chancellor
			name = he_attempted_fabricate_claim_chancellor_banned
			years = 99
		}
		clear_event_target = claim_noble
		clear_event_target = claim_chancellor
		clear_event_target = claim_liege
	}
	option = {
		#excellent!
		name = "L3T.84B"
		trigger = { has_character_flag = random_2 }
		clr_character_flag = random_2
		#hidden_tooltip = { 
			
			event_target:claim_noble = {
				reverse_opinion = {
					modifier = he_attempted_fabricate_claim_chancellor_banned
					who = event_target:claim_liege
					years = 10
				}
			}
		#}
		clear_event_target = claim_noble
		clear_event_target = claim_chancellor
		clear_event_target = claim_liege
	}
	option = {
		#excellent!
		name = "L3T.84C"
		trigger = { event_target:claim_chancellor = { has_character_flag = CHL_fled }}
		clr_character_flag = random_2
		#hidden_tooltip = { 
			
			event_target:claim_noble = {
				reverse_opinion = {
					modifier = he_attempted_fabricate_claim_chancellor_banned
					who = event_target:claim_liege
					years = 10
				}
			}
		#}
		clear_event_target = claim_noble
		clear_event_target = claim_chancellor
		clear_event_target = claim_liege
	}
}