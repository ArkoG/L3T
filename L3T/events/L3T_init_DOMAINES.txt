#################################
#         L3T  par Arko         #
#################################


namespace = L3T


## décider de l'avenir d'un domaine 

#Domaine Féodal     
narrative_event = {
	title = "NAMEL3T.3"
    id = L3T.3
	picture = GFX_evt_castle_construction

	desc = {
		trigger = { capital_holding = { has_title_flag = castle_to_specialize }}
		text = "DESCL3T.3.Cap"
		picture = GFX_evt_castle_construction
	}
	desc = {
		trigger = { NOT = { capital_holding = { has_title_flag = castle_to_specialize }}}
		text = "DESCL3T.3.pasCap"
		picture = GFX_evt_castle_construction
	}

	only_rulers = yes
	capable_only = yes
	prisoner = no

	trigger = {
		OR = {
			had_global_flag = { flag = SWMH days = 30 }			
			had_global_flag = { flag = running_VANILLA days = 30 }
			had_global_flag = { flag = running_LCDA days = 30 }
		}
		#NOT = { trait = chef_malandrin }
		any_demesne_title = {
			tier = baron
			holding_type = castle 
			NOT = {
				#has_building = REPAIREVOLEUR
				has_building = FEODAL_mil
				has_building = FEODAL_prod
				has_building = FEODAL_adm
			}
		}
	}	
		
	mean_time_to_happen = {
		months = 9
		modifier = {
			factor = 0.5
			OR = {
				had_global_flag = { flag = SWMH days = 360 }			
				had_global_flag = { flag = running_VANILLA days = 360 }
				had_global_flag = { flag = running_LCDA days = 360 }
			}
		}
	}

	immediate = {
		random_demesne_title = {
			limit = {
				tier = baron
				holding_type = castle
				NOT = {
					#has_building = REPAIREVOLEUR
					has_building = FEODAL_mil
					has_building = FEODAL_prod
					has_building = FEODAL_adm
				}
			}
			save_event_target_as = holding_to_spec
			set_title_flag = castle_to_specialize
			#set_variable = { which = "specNB" value = 0 } #debug
		}
	}

	option = {
		name = "L3T.3A" #ADM
		custom_tooltip = { text = custom_est_capitale }
		custom_tooltip = { text = custom_spec_industrie }
		trigger = {
			capital_holding = {
					has_title_flag = castle_to_specialize
			}
			OR = {
				higher_tier_than = COUNT # Duke, King or Emperor
				num_of_count_titles = 2
			}
			holy_order = no
		}
		ai_chance = {
			factor = 50		
			modifier = {
				factor =  10
				higher_tier_than = DUKE # King or Emperor
			}
			modifier = { factor = 1.2	num_of_count_titles = 2 }
			modifier = { factor = 1.2	num_of_count_titles = 3 }
			modifier = { factor = 1.1	num_of_count_titles = 4 }
			modifier = {
				factor =  10
				independent = yes
			}
		}
		capital_holding = {
			add_building = FEODAL_adm
			hidden_tooltip ={
				change_variable = { which = "developpement" value = 20 }
				change_variable = { which = "developpement_spec" value = 20 }
				#change_variable = { which = "specNB" value = 1 } #debug
			}
			add_holding_modifier = { name = feodal_adm_L1 duration = -1 }
			clr_title_flag = castle_to_specialize
			clear_event_target = holding_to_spec
		}
	}

	option = {
		name = "L3T.3B"	#MIL
		custom_tooltip = { text = custom_spec_milites }
		ai_chance = {
			factor = 50
			modifier = {
				factor = 3
				any_demesne_title = {
					has_title_flag = castle_to_specialize
					location = { NOT = { check_variable = { which = "resourceNb" value = 2 } } }
				}
			}
			modifier = {
				factor = 0.1
				capital_holding = {
					has_title_flag = castle_to_specialize
				}
			}
		}
		trigger = {
			any_demesne_title = {
				is_capital = no
				has_title_flag = castle_to_specialize
			}
		}
		random_demesne_title = {
			limit = {
				has_title_flag = castle_to_specialize
			}
			add_building = FEODAL_mil
			hidden_tooltip ={
				#change_variable = { which = "specNB" value = 1 } #debug
			}
			add_holding_modifier = { name = feodal_mil_L1 duration = -1 }	
			clr_title_flag = castle_to_specialize
			clear_event_target = holding_to_spec
		}
	}
	
	option = {
		name = "L3T.3C"	#ECO
		custom_tooltip = { text = custom_spec_production }
		ai_chance = { 
			factor = 50
			modifier = {
				factor = 3
				any_demesne_title = {
					has_title_flag = castle_to_specialize
					location = { check_variable = { which = "resourceNb" value = 2 } }
				}
			}
			modifier = {
				factor = 0.1
				capital_holding = {
					has_title_flag = castle_to_specialize
				}
			}
			modifier = {
				factor = 1.5
				any_demesne_title = {
					has_title_flag = castle_to_specialize
					location = { has_province_flag = crown_focus_province } #pondération capitale économique
				}
			}
			modifier = { factor = 0.5	holy_order = yes }
		}
		trigger = {
			holy_order = no
			any_demesne_title = {
				is_capital = no
				has_title_flag = castle_to_specialize
			}
		}
		random_demesne_title = {
			limit = {
				has_title_flag = castle_to_specialize
			}
			add_building = FEODAL_prod
			hidden_tooltip ={
				change_variable = { which = "developpement" value = 10 }
				change_variable = { which = "developpement_spec" value = 10 }
			#change_variable = { which = "specNB" value = 1 } #debug
			}
			add_holding_modifier = { name = feodal_prod_L1 duration = -1 }
			clr_title_flag = castle_to_specialize
			clear_event_target = holding_to_spec
		}
	}
}

#Domaine Féodal pour capitales de provinces 
province_event = {
    id = L3T.31
	hide_window = yes
	
	is_triggered_only = yes
		
	trigger = {
		capital_holding = { 
			holding_type = castle 
			NOT = {
				has_building = FEODAL_mil
				has_building = FEODAL_prod
				has_building = FEODAL_adm
			}
		}
	}

	immediate = {
		capital_holding = {
			if = {
				limit = {
					holding_type = castle
					NOT = {
						has_building = FEODAL_mil
						has_building = FEODAL_prod
						has_building = FEODAL_adm
					}
				}

				add_building = FEODAL_adm
				change_variable = { which = "developpement" value = 20 }
				change_variable = { which = "developpement_spec" value = 20 }
				#change_variable = { which = "specNB" value = 1 } #debug
				add_holding_modifier = { name = feodal_adm_L1 duration = -1 }
			}
		}
	}
}


#Domaine Communal     
narrative_event = {
	title = "NAMEL3T.4"
	id = L3T.4
	desc = "DESCL3T.4"
	picture = GFX_evt_L3T_city
	
	only_rulers = yes
	capable_only = yes
	prisoner = no
		
	trigger = {
		OR = {
			had_global_flag = { flag = SWMH days = 360 }			
			had_global_flag = { flag = running_VANILLA days = 360 }
			had_global_flag = { flag = running_LCDA days = 360 }
			AND = { # Priorité aux républiques
				is_republic = yes
				NOT = { tier = baron }
				OR = {
					had_global_flag = { flag = SWMH days = 60 }				
					had_global_flag = { flag = running_VANILLA days = 60 }
					had_global_flag = { flag = running_LCDA days = 60 }
				}
			}
		}
		any_demesne_title = {
			tier = baron
			holding_type = city
			NOT = {
				has_building = CITE_L1
				#has_building = CITE_L2
				has_building = VOC_INDUSTRIELLE
				has_building = VOC_COMMERCIALE
			}
		}
	}	
		
	mean_time_to_happen = {
		months = 9
		modifier = { factor = 0.1	NOT = { tier = baron }	}
		modifier = {
			factor = 0.5
			OR = {
				had_global_flag = { flag = SWMH days = 720 }			
				had_global_flag = { flag = running_VANILLA days = 720 }
				had_global_flag = { flag = running_LCDA days = 720 }
			}
		}
	}

	immediate = {
		random_demesne_title = {
			limit = {
				tier = baron
				holding_type = city
				NOT = {
					has_building = CITE_L1
					#has_building = CITE_L2
					has_building = VOC_INDUSTRIELLE
					has_building = VOC_COMMERCIALE
				}
			}
			save_event_target_as = holding_to_spec
			set_title_flag = city_to_specialize
			#set_variable = { which = "specNB" value = 0 } #debug
		}
	}
	
	option = {
		name = "L3T.4A"	
		custom_tooltip = { text = custom_spec_production }
		custom_tooltip = { text = custom_spec_industrie }
		ai_chance = { 
			factor = 50			
			modifier = {
				factor = 3
				any_demesne_title = {
					has_title_flag = city_to_specialize
					location = { is_variable_equal = { which = "resourceNb" value = 2 } }
				}
			}
			modifier = {
				factor = 0.1
				any_demesne_title = {
					has_title_flag = city_to_specialize
					location = { is_variable_equal = { which = "resourceNb" value = 1 } }
				}
			}
		}	
		random_demesne_title = {
			limit = {
				has_title_flag = city_to_specialize
			}
			add_building = CITE_L1
			add_building = VOC_INDUSTRIELLE
			hidden_tooltip ={
				change_variable = { which = "developpement" value = 20 }
				change_variable = { which = "developpement_spec" value = 20 }
				#change_variable = { which = "specNB" value = 1 } #debug
			}
			add_holding_modifier = { name = voc_indus_L1 duration = -1 }
			clr_title_flag = city_to_specialize
			clear_event_target = holding_to_spec
		}
	}
	
	option = {
		name = "L3T.4B"
		custom_tooltip = { text = custom_spec_commerce }
		trigger = {
			any_demesne_title = {
				has_title_flag = city_to_specialize
				
				# Pas de cité commerçante dans la province et les provinces voisines
				location = {
					NOT = {
						any_province_holding = {
							tier = baron
							holding_type = city
							has_building = VOC_COMMERCIALE
						}
						any_neighbor_province = {
							OR = {
								has_province_flag = neighbor_bloc_A
								has_province_flag = neighbor_neighbor_bloc_A
							}
						}
					}
				}				
			}
		}
		ai_chance = {
			factor = 10
			modifier = { factor = 100	NOT = { tier = baron }	}
			modifier = { factor = 0.7	tier = baron }
			modifier = { 
				factor = 2
				any_demesne_title = {
					location = { trade_route = silk_road } #favors starting points on the silk_road
				}
			}
			modifier = {
				factor = 0.1
				any_demesne_title = {
					has_title_flag = city_to_specialize
					location = { is_variable_equal = { which = "resourceNb" value = 3 } }
				}
			}
		}
		random_demesne_title = {
			limit = {
				tier = baron
				holding_type = city
				NOT = {
					has_building = CITE_L1
					#has_building = CITE_L2
					has_building = VOC_INDUSTRIELLE
					has_building = VOC_COMMERCIALE
				}
				# Pas de cité commerçante dans la province et les provinces voisines
				location = {
					NOT = {
						any_province_holding = {
							tier = baron
							holding_type = city
							has_building = VOC_COMMERCIALE
						}
						any_neighbor_province = {
							OR = {
								has_province_flag = neighbor_bloc_A
								has_province_flag = neighbor_neighbor_bloc_A
							}
						}
					}
				}
			}
			add_building = CITE_L1
			add_building = VOC_COMMERCIALE
			hidden_tooltip ={
				change_variable = { which = "developpement" value = 30 }
				change_variable = { which = "developpement_spec" value = 30 }
				#change_variable = { which = "specNB" value = 1 } #debug
			}
			add_holding_modifier = { name = voc_comm_L1 duration = -1 }
			# La province devient le départ d'une route	si possible
			location = {
				if = {
					limit = {
						NOT = {
							# N'est pas déjà prévu pour être sur une route
							has_province_flag = bloc_A
							has_province_flag = bloc_B
							has_province_flag = bloc_C
							has_province_flag = bloc_D
							has_province_flag = bloc_E	
							
							# N'a pas déjà des voisins prévus pour être sur une route de manière incompatible
							any_neighbor_province = {
								has_province_flag = bloc_A
								has_province_flag = bloc_C
								has_province_flag = bloc_D
								has_province_flag = bloc_E
							}
						}
					}				
					set_province_flag = bloc_A
					add_province_modifier = { name = prosperity_modifier_2 duration = -1 }
					
					# Marque les voisins et voisins de voisins pour faire une distance entre les blocs A
					any_neighbor_province = {
						set_province_flag = neighbor_bloc_A
						any_neighbor_province = {
							limit = {
								NOT = {
									has_province_flag = neighbor_bloc_A									
									has_province_flag = neighbor_neighbor_bloc_A
									has_province_flag = bloc_A
								}
							}
							set_province_flag = neighbor_neighbor_bloc_A
						}
					}
					
					add_province_modifier = { name = route_size1 duration = -1 }
					set_variable = { which = "route_size" value = 1 }
					if = {
						limit = { has_province_modifier = province_fleuve }
						add_province_modifier = { name = route_fluviale duration = -1 hidden = yes }
						any_province_holding = {
							limit = {
								tier = baron
								OR = {
									holding_type = castle
									holding_type = temple
									holding_type = city
								}
							}
							change_variable = { which = "developpement" value = 50 } # 10 pour la route + 30 pour le noeud + 10 pour le route size 1
							change_variable = { which = "developpement_road" value = 50 }
						}
					}
					if = {
						limit = { NOT = { has_province_modifier = province_fleuve } }
						add_province_modifier = { name = route_terrestre duration = -1 hidden = yes }
						any_province_holding = {
							limit = {
								OR = {
									holding_type = castle
									holding_type = temple
									holding_type = city
								}
							}
							change_variable = { which = "developpement" value = 50 } # 10 pour la route + 30 pour le noeud + 10 pour le route size 1
							change_variable = { which = "developpement_spec" value = 50 }
						}
					}
					# Avert the player that a route is on its demesne
					any_province_lord = {
						limit = {
							ai = no
							NOT = { has_global_flag = avert_player } # assure that the player is averted only once
						}
						set_global_flag = avert_player
						narrative_event = { id = L3TRADE.10 days = 10}
					}
						
					# Avert the player that the route building can be build on its demesne
					any_neighbor_province = {
						any_province_lord = {
							limit = {
								ai = no
								NOT = { has_global_flag = avert_player }
							}
							set_global_flag = avert_player
							character_event = { id = L3TRADE.9 days = 10}
						}
					}
					clr_global_flag = avert_player
				}
			}
			clr_title_flag = city_to_specialize	
			clear_event_target = holding_to_spec
		}
	}
}

#domaine Communal province à double cité  
province_event = {
    id = L3T.41
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		# Une cité sera commerçante
		random_province_holding = {
			limit = {
				tier = baron
				holding_type = city
				NOT = {
					has_building = CITE_L1
					has_building = VOC_INDUSTRIELLE
					has_building = VOC_COMMERCIALE
				}
			}
			add_building = CITE_L1
			add_building = VOC_COMMERCIALE
			hidden_tooltip ={
				change_variable = { which = "developpement" value = 30 }
				change_variable = { which = "developpement_spec" value = 30 }
				#change_variable = { which = "specNB" value = 1 } #debug
			}
			add_holding_modifier = { name = voc_comm_L1 duration = -1 }
			
			# La province devient le départ d'une route si elle est distance au moins 3 d'un autre
			if =  {
				limit = {
					location = {
						NOT = {
							any_neighbor_province = {
								OR = {
									has_province_flag = bloc_A
									has_province_flag = neighbor_bloc_A
									has_province_flag = neighbor_neighbor_bloc_A
								}
							}
						}
					}
				}
				location = {
					set_province_flag = bloc_A
					any_neighbor_province = {
						set_province_flag = neighbor_bloc_A
						any_neighbor_province = {
							limit = {
								NOT = {
									has_province_flag = neighbor_bloc_A									
									has_province_flag = neighbor_neighbor_bloc_A
									has_province_flag = bloc_A
								}
							}
							set_province_flag = neighbor_neighbor_bloc_A
						}
					}
					add_province_modifier = { name = route_size1 duration = -1 }
					add_province_modifier = { name = prosperity_modifier_2 duration = -1 }
					set_variable = { which = "route_size" value = 1 }
					if = {
						limit = { has_province_modifier = province_fleuve }
						add_province_modifier = { name = route_fluviale duration = -1 hidden = yes}
						any_province_holding = {
							limit = {
								OR = {
									holding_type = castle
									holding_type = temple
									holding_type = city
								}
							}
							change_variable = { which = "developpement" value = 50 } # 10 pour la route + 30 pour le noeud + 10 pour le route size 1
							change_variable = { which = "developpement_road" value = 50 }
						}
					}
					if = {
						limit = { NOT = { has_province_modifier = province_fleuve } }
						add_province_modifier = { name = route_terrestre duration = -1 hidden = yes}
						any_province_holding = {
							limit = {
								OR = {
									holding_type = castle
									holding_type = temple
									holding_type = city
								}
							}
							change_variable = { which = "developpement" value = 50 } # 10 pour la route + 30 pour le noeud + 10 pour le route size 1
							change_variable = { which = "developpement_road" value = 50 }
						}
					}
					# Avert the player that a route is on its demesne
					any_province_lord = {
						limit = {
							ai = no
							NOT = { has_global_flag = avert_player } # assure that the player is averted only once
						}
						set_global_flag = avert_player
						narrative_event = { id = L3TRADE.10 days = 10}
					}	
					
					# Avert the player that the route building can be build on its demesne
					any_neighbor_province = {
						any_province_lord = {
							limit = {
								ai = no
								NOT = { has_global_flag = avert_player }
							}
							set_global_flag = avert_player
							character_event = { id = L3TRADE.9 days = 10}
						}
					}
					clr_global_flag = avert_player
				}
			}
		}
		
		# Les autres productrices
		any_province_holding = {
			if = {
				limit = {
					tier = baron
					holding_type = city
					NOT = { has_building = VOC_COMMERCIALE }
				}
				add_building = CITE_L1
				add_building = VOC_INDUSTRIELLE
				hidden_tooltip ={
					change_variable = { which = "developpement" value = 20 }
					change_variable = { which = "developpement_spec" value = 20 }
					#change_variable = { which = "specNB" value = 1 } #debug
				}
				add_holding_modifier = { name = voc_indus_L1 duration = -1 }
			}
		}
	}
}
#City Apocalypto
#called on_action - inactive ATM-
character_event = {
	id = L3T.45
	#desc = DESCL3T.13
	#picture = GFX_evt_castle_construction
	#border = GFX_event_normal_frame_religion
	hide_window = yes
	
	is_triggered_only = yes 
	
	trigger = {
		#has_game_rule = {
		#	name = essor_urbain
		#	value = dynamic
		#}
		NOT = { has_global_flag = running_LCDA }
		NOT = { has_global_flag = apocalypto_finished }
		tier = baron
		is_patrician = no
		is_merchant_republic  = no
		capital_holding = {
			holding_type = city
			NOT = { has_title_flag = saved_from_apocalypto }
			is_patrician = no
			is_merchant_republic  = no
		}
	}

	immediate = {
		character_event = { id = L3T.46 days = 150 }
		capital_holding = {
			if = { #multi cities
				limit = {
					location = {
						any_province_holding = {
							holding_type = city
							count = 2
							tier = baron
						}
					}
					tier = baron
					holding_type = city
					NOT = { has_title_flag = saved_from_apocalypto }
					is_patrician = no
					is_merchant_republic  = no
				}
				random_list = {
					25 = { 
						convert_to = CASTLE
						refill_holding_levy = yes
						holder_scope = { 	set_government_type = feudal_government }
						#set_title_flag = city_2_convert
						add_holding_modifier = { modifier = agriculture3_farine years = -1 } #mouchard
					}
					25 = { 
						modifier = {  factor = 2.0		NOT = { year =  999 }}
						destroy_settlement = THIS
					}
					50 = { 
						modifier = {  factor = 1.5		holder_scope = { 	religion_group = muslim }}
						modifier = {  factor = 0.5		NOT = { year =  999 }}
						set_title_flag = saved_from_apocalypto
						add_holding_modifier = { modifier = agriculture4_pain years = -1 } #mouchard
					}
				}
			}
			if = { #mono cities, muslim
				limit = {
					location = {
						NOT = { religion_group = muslim }
						any_province_holding = {
							holding_type = city
							NOT = { count = 2 }
							tier = baron
						}
					}
					tier = baron
					holding_type = city
					NOT = {
						has_title_flag = saved_from_apocalypto
						is_patrician = yes
						is_merchant_republic  = yes
					}
				}
				random_list = {
					50 = { 
						convert_to = CASTLE
						refill_holding_levy = yes
						holder_scope = { 	set_government_type = feudal_government }
						#set_title_flag = city_2_convert
						add_holding_modifier = { modifier = agriculture3_farine years = -1 } #mouchard
					}
					50 = { 
						destroy_settlement = THIS
					}
				}
			}
			if = { #mono cities, non muslim
				limit = {
					location = {
						religion_group = muslim
						any_province_holding = {
							holding_type = city
							NOT = { count = 2 }
							tier = baron
						}
					}
					tier = baron
					holding_type = city
					NOT = {
						has_title_flag = saved_from_apocalypto
						is_patrician = yes
						is_merchant_republic  = yes
					}
				}
				random_list = {
					30 = { 
						convert_to = CASTLE
						refill_holding_levy = yes
						holder_scope = { 	set_government_type = feudal_government }
						#set_title_flag = city_2_convert
						add_holding_modifier = { modifier = agriculture3_farine years = -1 } #mouchard
					}
					30 = { 
						modifier = {  factor = 2.0		NOT = { year =  999 }}
						modifier = {  factor = 1.2		region = world_europe_north }
						modifier = {  factor = 0.8		region = world_europe_south }
						#modifier = {  factor = 0.8		narbonaise_lands =  yes }
						destroy_settlement = THIS
					}
					30 = { 
						#modifier = {  factor = 0.5		NOT = { year =  999 }}
						modifier = {  factor = 1.5		year = 1200 }
						set_title_flag = saved_from_apocalypto
						add_holding_modifier = { modifier = agriculture4_pain years = -1 } #mouchard
					}
				}
			}
		}
	}
}
character_event = { 
    id = L3T.46
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_global_flag = apocalypto_finished }
	}

	immediate = {
		set_global_flag = apocalypto_finished
	}
}
#upgrade CITE L1 vers L2
#narrative_event = {
#	title = "NAMEL3T.5"
#	desc = "DESCL3T.5"
#    id = L3T.5
#	picture = GFX_evt_L3T_city
#	
#	only_rulers = yes
#	capable_only = yes
#	#prisoner = no
#	
#	trigger = {
#		#OR = { #dealt through gov_type instead of religion
#		#   NOT = { religion_group = pagan_group }
#		#   religion = west_african_pagan
#		#   religion = west_african_pagan_reformed
#		#}
#		any_demesne_title = {
#			tier = baron
#			holding_type = city
#			num_of_buildings = 25 #à changer une fois testé
#			has_building = CITE_L1
#			
#			NOT = { has_building = CITE_L2 }
#		}
#	}	
#		
#	mean_time_to_happen = { days = 450 }	
#
#	option = {
#		name = "L3T.5A"	
#		random_demesne_title = {
#			limit = {
#				tier = baron
#				holding_type = city
#				num_of_buildings = 25 #à changer une fois testé -25-
#				NOT = { has_building = CITE_L2 }
#			}
#			add_building = CITE_L2
#		}
#	}
#}

#upgrade CITE L2 vers L3
#narrative_event = {
#	title = "NAMEL3T.2"
#	desc = "DESCL3T.2"
#    id = L3T.2
#	picture = GFX_evt_L3T_city
#	
#	only_rulers = yes
#	capable_only = yes
#	#prisoner = no
#		
#	trigger = {
#		OR = {
#		   NOT = { religion_group = pagan_group }
#		   religion = west_african_pagan
#		   religion = west_african_pagan_reformed
#		}
#		any_demesne_title = {
#			tier = baron
#			holding_type = city
#			num_of_buildings = 45 #à changer une fois testé
#			has_building = CITE_L2
#			
#			NOT = { has_building = CITE_L3 }
#		}
#	}	
#		
#	mean_time_to_happen = { days = 450 }	
#
#	option = {
#		name = "L3T.2A"	
#		random_demesne_title = {
#			limit = {
#				tier = baron
#				holding_type = city
#				num_of_buildings = 45 #à changer une fois testé -25-
#				NOT = { has_building = CITE_L3 }
#			}
#			add_building = CITE_L3
#		}
#	}
#}


#Domaine Ecclésial     
narrative_event = {
    id = L3T.6
	title = "NAMEL3T.6"
	picture = GFX_evt_monk
	border = GFX_event_narrative_frame_religion
	desc = "DESCL3T.6" #ne mettre que si tous les cas ne sont pas couverts par les triggers 
	
	only_rulers = yes
	capable_only = yes
	prisoner = no
		
	trigger = {	
		OR = {
			had_global_flag = { flag = SWMH days = 360 }			
			had_global_flag = { flag = running_VANILLA days = 360 }
			had_global_flag = { flag = running_LCDA days = 360 }
		}		
		any_demesne_title = {
			holding_type = temple
			location = { religion_group = christian }
			NOT = { has_title_flag = temple_to_specialize }
			NOT = {
				has_building = MONASTERE
				has_building = CITEEPISCOPALE
				has_building = BOURG_EPISCOPAL
			}
			##hardcode works only on startup
			#is_LCDA_hard_monastery = no
			#is_LCDA_hard_episcopat = no
			#is_SWMH_hard_monastery =no
			#is_SWMH_hard_episcopat = no
			#is_VANILLA_hard_monastery =no
			#is_VANILLA_hard_episcopat = no
		}
	}

	mean_time_to_happen = {
		months = 9 
		modifier = {
			factor = 0.7
			OR = {
				had_global_flag = { flag = SWMH days = 100 }			
				had_global_flag = { flag = running_VANILLA days = 100 }
				had_global_flag = { flag = running_LCDA days = 100 }
			}
		}
	}
	
	immediate = {
		random_demesne_title = {
			limit = {
				holding_type = temple
				location = { religion_group = christian }
				NOT = { has_title_flag = temple_to_specialize }
				NOT = {
					has_building = MONASTERE
					has_building = CITEEPISCOPALE
					has_building = BOURG_EPISCOPAL
				}
				#is_LCDA_hard_monastery =no
				#is_LCDA_hard_episcopat = no
				#is_SWMH_hard_monastery =no
				#is_SWMH_hard_episcopat = no
				#is_VANILLA_hard_monastery =no
				#is_VANILLA_hard_episcopat = no
			}
			set_title_flag = temple_to_specialize
			set_variable = { which = "specNB" value = 0 } #debug
			save_event_target_as = holding_to_spec
		}
	}
	
	option = {
		name = "L3T.6A"
		custom_tooltip = { text = custom_spec_production }		
		ai_chance = {
			factor = 50
			#favored by a monk/erudite profile
			modifier = { 
				factor = 2
				learning = 20
			}
			modifier = {
				factor = 2
				learning = 15
			}
			modifier = {
				factor = 0.75
				NOT = { learning = 10 }
			}
			modifier = {
				factor = 1.5
				capital_holding = { has_building = MONASTERE }
			}
		}
		trigger = {
			any_demesne_title = {
				location = { religion_group = christian }
				has_title_flag = temple_to_specialize
				#is_LCDA_hard_monastery = no
				#is_LCDA_hard_episcopat = no
				is_capital = no
			}
		}
		random_demesne_title = {
			limit = {
				location = { religion_group = christian }
				has_title_flag = temple_to_specialize
				#is_LCDA_hard_monastery = no
				#is_LCDA_hard_episcopat = no
			}
			#clear_event_target = holding_to_spec #is cleared by monastic rule event instead
			if = {
				limit = {
					NOT = {
						has_building = MONASTERE
						has_building = CITEEPISCOPALE
						has_building = BOURG_EPISCOPAL
					}
				}
				add_building = MONASTERE
				clr_title_flag = temple_to_specialize
				set_title_flag = L3T6_made_me_opt_A
				hidden_tooltip ={
					change_variable = { which = "developpement" value = 10 }
					change_variable = { which = "developpement_spec" value = 10 }
				}
				add_holding_modifier = { name = monastere_L1 duration = -1 }
				hidden_tooltip = { change_variable = { which = "specNB" value = 1 }} #debug
				holder_scope = { narrative_event = { id = L3T.7 days = 0 }} ####MAKE IT automatic ONCE new holdings will be built by decision only######
				clear_event_target = holding_to_spec
			}
			if = {
				limit = {
					location = {
						OR = {
							religion = orthodox
							is_heresy_of = orthodox
						}
					}
					NOT = { has_building = REGLE_DE_3 }
				}
				add_building = REGLE_DE_3 #saint-Basile
			}
		}
		set_character_flag = canGetEasterEgg3
	}
	
	option = {
		name = "L3T.6B"	
		custom_tooltip = { text = custom_spec_production }
		ai_chance = {
			factor = 50
			#favored by an intendant or a protector profile
			modifier = { 
				factor = 2
				stewardship = 15
			}
			modifier = {
				factor = 2
				martial = 15
			}
			modifier = {
				factor = 0.75
				NOT = { stewardship = 10 }
				NOT = { martial = 10 }
			}
			modifier = {
				factor = 1.5
				capital_holding = { has_building = CITEEPISCOPALE }
			}
		}
		trigger = {
			any_demesne_title = {
				location = { religion_group = christian }
				has_title_flag = temple_to_specialize
				is_capital = no
			}
		}
		random_demesne_title = {
			limit = {
				location = { religion_group = christian }
				has_title_flag = temple_to_specialize
			}
			clear_event_target = holding_to_spec
			clr_title_flag = temple_to_specialize
			if = {
				limit = {
					NOT = {
						has_building = MONASTERE
						has_building = CITEEPISCOPALE
						has_building = BOURG_EPISCOPAL
					}
				}
				add_building = BOURG_EPISCOPAL
				set_title_flag = L3T6_made_me_opt_B
				hidden_tooltip ={
					change_variable = { which = "developpement" value = 10 }
					change_variable = { which = "developpement_spec" value = 10 }
				}
				add_holding_modifier = { name = episco_land_L1 duration = -1 }
			}
			hidden_tooltip = { change_variable = { which = "specNB" value = 1 }} #debug			
		}
	}
	option = {
		name = "L3T.6C"	
		custom_tooltip = { text = custom_spec_industrie }
		custom_tooltip = { text = custom_est_capitale }
		
		trigger = {
			any_demesne_title = {
				is_capital = yes #it is a capital, it doens't need to follow the grid
				location = { religion_group = christian }
				has_title_flag = temple_to_specialize
			}
		}
		capital_holding = {
			limit = {
				location = { religion_group = christian }
				has_title_flag = temple_to_specialize
			}
			clear_event_target = holding_to_spec
			clr_title_flag = temple_to_specialize
			if = {
				limit = { 
					location = { NOT = { has_province_modifier = relique_generique }}
				}
				location = { 
					add_province_modifier = {
						name = relique_generique
						duration = -1
					}
				}
			}				
			if = {
				limit = {
					NOT = {
						has_building = MONASTERE
						has_building = CITEEPISCOPALE
						has_building = BOURG_EPISCOPAL
					}
				}
				add_building = tp_roman_cathedrale
				save_event_target_as = lieu_cathedrale
				location = { 
					add_wonder = wonder_cathedral_romane
					wonder = { 
						add_wonder_stage = 1
						set_name = wonder_cathedral_romane
						set_description = wonder_cathedral_romane_desc
					}
				}
				add_building = CITEEPISCOPALE
				set_title_flag = L3T6_made_me_opt_C
				hidden_tooltip ={
					change_variable = { which = "developpement" value = 15 }
					change_variable = { which = "developpement_spec" value = 15 }
				}
				add_holding_modifier = { name = episcopale_L1 duration = -1 }
			}
			hidden_tooltip = { change_variable = { which = "specNB" value = 1 }} #debug
			location = {
				set_province_flag = roman_cathedral
				any_neighbor_province = {
					set_province_flag = neighbor_roman_cathedral	
					any_neighbor_province = {
						limit = {
							NOT = {
								has_province_flag = neighbor_roman_cathedral									
								has_province_flag = neighbor_neighbor_roman_cathedral
								has_province_flag = roman_cathedral
							}
						}
						set_province_flag = neighbor_neighbor_roman_cathedral
					}
				}
			}
		}
	}
}

 ##church spec for hardcode
province_event = {
    id = L3T.61
	hide_window = yes
	
	is_triggered_only = yes
	#trigger = { unecessary unless i delay the events}
	
	trigger = {		
		any_province_holding = {
			holding_type = temple
			OR = {
				is_LCDA_hard_monastery = yes
				is_LCDA_hard_episcopat = yes
				is_VANILLA_hard_monastery = yes
				is_VANILLA_hard_episcopat = yes
				is_SWMH_hard_monastery = yes
				is_SWMH_hard_episcopat = yes
			}
			NOT = {
				has_building = MONASTERE
				has_building = CITEEPISCOPALE
				has_building = BOURG_EPISCOPAL
			}
		}
	}

	immediate = {
		any_province_holding = {
			limit = {
				holding_type = temple
				##MONASTERY
				is_LCDA_hard_episcopat = no
				is_VANILLA_hard_episcopat = no
				is_SWMH_hard_episcopat = no
				OR = {
					is_LCDA_hard_monastery = yes
					is_VANILLA_hard_monastery = yes
					is_SWMH_hard_monastery = yes
				}
				NOT = {
					has_building = MONASTERE
					has_building = CITEEPISCOPALE
					has_building = BOURG_EPISCOPAL
				}
			}
			set_variable = { which = "specNB" value = 0 } #debug
			add_building = MONASTERE
			set_title_flag = L3T61_made_me_cas_Aa
			hidden_tooltip ={
				change_variable = { which = "developpement" value = 10 }
				change_variable = { which = "developpement_spec" value = 10 }
			}
			add_holding_modifier = { name = monastere_L1 duration = -1 }
			hidden_tooltip = { change_variable = { which = "specNB" value = 1 }} #debug
			holder_scope = { set_character_flag = canGetEasterEgg3 }
			
			#add rule automaticaly
			if = {
				limit = { 
					OR = {
						is_LCDA_hard_regula1 = yes
						is_SWMH_hard_regula1 = yes
						is_VANILLA_hard_regula1 = yes
					}
				}
				add_building = REGLE_DE_1
			}
			if = {
				limit = { 
					OR = {
						is_LCDA_hard_regula2 = yes
						is_SWMH_hard_regula2 = yes
						is_VANILLA_hard_regula2 = yes
					}
				}
				add_building = REGLE_DE_2
			}
			if = {
				limit = { 
					is_LCDA_hard_regula1 = no
					is_LCDA_hard_regula2 = no
					is_SWMH_hard_regula1 = no
					is_SWMH_hard_regula2 = no
					is_VANILLA_hard_regula1 = no
					is_VANILLA_hard_regula2 = no
				}
				random_list = {
					10 = { add_building = REGLE_DE_1 }
					10 = { add_building = REGLE_DE_2 }
				}
			}
			
			# Romanesque Cathedral/Basilique for monastery if capital holding
			if = {
				limit = {
					is_capital = yes
					location = {
						is_catholic_group = yes #not orthodox or heresy of
						#religion_group = christian
						NOT = {
							had_global_flag = { flag = opus_francigenum days = 360 }
							has_province_flag = roman_cathedral
						}
					}
				}
				add_building = tp_roman_cathedrale
				save_event_target_as = lieu_cathedrale
				location = { 
					add_wonder = wonder_cathedral_romane
					wonder = { 
						add_wonder_stage = 1
						set_name = wonder_cathedral_romane
						set_description = wonder_cathedral_romane_desc
					}
				}
				set_title_flag = L3T61_made_me_cas_Ab

				hidden_tooltip = { change_variable = { which = "specNB" value = 1 }} #debug
				location = {
					set_province_flag = roman_cathedral
					any_neighbor_province = {
						set_province_flag = neighbor_roman_cathedral	
						any_neighbor_province = {
							limit = {
								NOT = {
									has_province_flag = neighbor_roman_cathedral									
									has_province_flag = neighbor_neighbor_roman_cathedral
									has_province_flag = roman_cathedral
								}
							}
							set_province_flag = neighbor_neighbor_roman_cathedral
						}
					}
				}
				if = { 
					limit = {
						location = {
							NOT = { has_province_modifier = relique_generique }
						}
					}
					location = {
						add_province_modifier = {
							name = relique_generique
							duration = -1
						}
					}
				}
			}
		}
		
		#hardcode episco
		any_province_holding = {
			limit = {
				holding_type = temple
				##EPISCOPAT
				is_LCDA_hard_monastery = no
				is_SWMH_hard_monastery = no
				is_VANILLA_hard_monastery = no
				OR = {
					is_LCDA_hard_episcopat = yes
					is_SWMH_hard_episcopat = yes
					is_VANILLA_hard_episcopat = yes
				}
				NOT = {
					has_building = MONASTERE
					has_building = CITEEPISCOPALE
					has_building = BOURG_EPISCOPAL
				}
			}
			set_variable = { which = "specNB" value = 0 } #debug
			add_building = CITEEPISCOPALE
			set_title_flag = L3T61_made_me_cas_B
			hidden_tooltip ={
				change_variable = { which = "developpement" value = 15 }
				change_variable = { which = "developpement_spec" value = 15 }
			}
			add_holding_modifier = { name = episcopale_L1 duration = -1 }

			# Romanesque Cathedral for all hardcode episcopal seat
			if = {
				limit = {
					location = {
						is_catholic_group = yes #not orthodox or heresy of
						NOT = {
							had_global_flag = { flag = opus_francigenum days = 360 }
							has_province_flag = roman_cathedral
						}
					}				
				}
				add_building = tp_roman_cathedrale
				save_event_target_as = lieu_cathedrale
				location = { 
					add_wonder = wonder_cathedral_romane
					wonder = { 
						add_wonder_stage = 1
						set_name = wonder_cathedral_romane
						set_description = wonder_cathedral_romane_desc
					}
				}
				hidden_tooltip = { change_variable = { which = "specNB" value = 1 }} #debug
				location = {
					set_province_flag = roman_cathedral
					any_neighbor_province = {
						set_province_flag = neighbor_roman_cathedral	
						any_neighbor_province = {
							limit = {
								NOT = {
									has_province_flag = neighbor_roman_cathedral									
									has_province_flag = neighbor_neighbor_roman_cathedral
									has_province_flag = roman_cathedral
								}
							}
							set_province_flag = neighbor_neighbor_roman_cathedral
						}
					}
				}
				if = {
					limit = {
						location = {
							NOT = { has_province_modifier = relique_generique }
						}
					}
					location = {
						add_province_modifier = {
							name = relique_generique
							duration = -1
						}
					}
				}
			}
		}
		
	}
	
}

 ##church spec open to non hardcode -CAPITALS-
#old cathedral and spe in religious province, christian only
province_event = {
    id = L3T.62
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = { 
		religion_group = christian
		NOT = { has_province_flag = roman_cathedral }
		capital_holding = { 
			holding_type = temple
			is_LCDA_hard_monastery =no
			is_LCDA_hard_episcopat = no
			is_SWMH_hard_monastery =no
			is_SWMH_hard_episcopat = no
			is_VANILLA_hard_monastery =no
			is_VANILLA_hard_episcopat = no
			NOT = {
				has_building = MONASTERE
				has_building = CITEEPISCOPALE
				has_building = BOURG_EPISCOPAL
			}
		}
	}
			
	immediate = {
		if = {
			limit = {
				NOT = { has_province_modifier = relique_generique }
			}
			add_province_modifier = {
				name = relique_generique
				duration = -1
			}
		}
		if = {
			limit = {
				#religion_group = christian
				is_catholic_group = yes #not orthodox or heresy of
				capital_holding = { 
					holding_type = temple
					is_LCDA_hard_monastery =no
					is_LCDA_hard_episcopat = no
					is_SWMH_hard_monastery =no
					is_SWMH_hard_episcopat = no
					is_VANILLA_hard_monastery =no
					is_VANILLA_hard_episcopat = no
				}
			}
			capital_holding = {
				add_building = tp_roman_cathedrale
				save_event_target_as = lieu_cathedrale
				location = { 
					add_wonder = wonder_cathedral_romane
					wonder = { 
						add_wonder_stage = 1
						set_name = wonder_cathedral_romane
						set_description = wonder_cathedral_romane_desc
					}
				}
				add_building = CITEEPISCOPALE
				set_title_flag = L3T62_made_me
				hidden_tooltip ={
					change_variable = { which = "developpement" value = 15 }
					change_variable = { which = "developpement_spec" value = 15 }
				}
				add_holding_modifier = { name = episcopale_L1 duration = -1 }
				hidden_tooltip = { change_variable = { which = "specNB" value = 1 }} #debug
			}
		}
		set_province_flag = roman_cathedral
		any_neighbor_province = {
			set_province_flag = neighbor_roman_cathedral	
			any_neighbor_province = {
				limit = {
					NOT = {
						has_province_flag = neighbor_roman_cathedral									
						has_province_flag = neighbor_neighbor_roman_cathedral
						has_province_flag = roman_cathedral
					}
				}
				set_province_flag = neighbor_neighbor_roman_cathedral
			}
		}
	}
}
##church spec open to non hardcode -non CAPITALS-
#old cathedral and spe in religious province, christian only
province_event = {
    id = L3T.63
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		any_province_holding = {
			location = {
				religion_group = christian
				NOT = {
					has_province_flag = neighbor_roman_cathedral									
					has_province_flag = neighbor_neighbor_roman_cathedral
					has_province_flag = roman_cathedral
				}
				any_neighbor_province = {
					NOT = {
						has_province_flag = neighbor_roman_cathedral									
						has_province_flag = neighbor_neighbor_roman_cathedral
						has_province_flag = roman_cathedral
					}
				}
				NOT = { has_province_modifier = relique_generique }
			}
			holding_type = temple
			#NOT = { has_title_flag = temple_to_specialize }
			NOT = {
				has_building = MONASTERE
				has_building = CITEEPISCOPALE
				has_building = BOURG_EPISCOPAL
				has_building = tp_roman_cathedrale
			}
			is_capital = no
			is_LCDA_hard_monastery =no
			is_LCDA_hard_episcopat = no
			is_SWMH_hard_monastery =no
			is_SWMH_hard_episcopat = no
			is_VANILLA_hard_monastery =no
			is_VANILLA_hard_episcopat = no
		}
	}
	
	immediate = {
		random_province_holding = {
			limit = {
				location = {
					is_catholic_group = yes #not orthodox or heresy of
					#religion_group = christian
					NOT = {
						has_province_flag = neighbor_roman_cathedral									
						has_province_flag = neighbor_neighbor_roman_cathedral
						has_province_flag = roman_cathedral
					}
					any_neighbor_province = {
						NOT = {
							has_province_flag = neighbor_roman_cathedral									
							has_province_flag = neighbor_neighbor_roman_cathedral
							has_province_flag = roman_cathedral
						}
					}
					NOT = { has_province_modifier = relique_generique }
				}
				holding_type = temple
				NOT = {
					has_building = MONASTERE
					has_building = CITEEPISCOPALE
					has_building = BOURG_EPISCOPAL
					has_building = tp_roman_cathedrale
				}
				is_capital = no
				is_LCDA_hard_monastery =no
				is_LCDA_hard_episcopat = no
				is_SWMH_hard_monastery =no
				is_SWMH_hard_episcopat = no
				is_VANILLA_hard_monastery =no
				is_VANILLA_hard_episcopat = no				
			}
			add_building = tp_roman_cathedrale
			save_event_target_as = lieu_cathedrale
				location = { 
					add_wonder = wonder_cathedral_romane
					wonder = { 
						add_wonder_stage = 1
						set_name = wonder_cathedral_romane
						set_description = wonder_cathedral_romane_desc
					}
				}
			add_building = CITEEPISCOPALE
			set_title_flag = L3T63_made_me
			hidden_tooltip ={
				change_variable = { which = "developpement" value = 15 }
				change_variable = { which = "developpement_spec" value = 15 }
			}
			add_holding_modifier = { name = episcopale_L1 duration = -1 }
			hidden_tooltip = { change_variable = { which = "specNB" value = 1 }} #debug
			location = {
				set_province_flag = roman_cathedral
				any_neighbor_province = {
					set_province_flag = neighbor_roman_cathedral
					any_neighbor_province = {
						limit = {
							NOT = {
								has_province_flag = neighbor_roman_cathedral									
								has_province_flag = neighbor_neighbor_roman_cathedral
								has_province_flag = roman_cathedral
							}
						}
						set_province_flag = neighbor_neighbor_roman_cathedral
					}
				}
				add_province_modifier = {
					name = relique_generique
					duration = -1
				}
			}
		}
	}
}

#Attribution règle
narrative_event = {
	title = "NAMEL3T.7"
    id = L3T.7
	desc = "DESCL3T.7"
	picture = GFX_evt_monastery_monks
	
	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes 
	
	trigger = {
		any_demesne_title = {
			location = {
				is_catholic_group = yes
			}
			tier = baron
			holding_type = temple
			has_building = MONASTERE
			NOT = {
				has_building = REGLE_DE_1
				has_building = REGLE_DE_2				
				#has_building = REGLE_DE_3
			}
		}
	}
		
	#mean_time_to_happen = { months = 9 }	

	#Regula Benedicti
	option = {
		name = "L3T.7A"	
#		trigger = {
#			any_demesne_title = {
#				location = {
#					is_catholic_group = yes
#				}
#			}
#		}
		random_demesne_title = {
			limit = {
				tier = baron
				holding_type = temple
				has_building = MONASTERE
				NOT = {
					has_building = REGLE_DE_1
					has_building = REGLE_DE_2				
					#has_building = REGLE_DE_3
				}
			}
			add_building = REGLE_DE_1
			clear_event_target = holding_to_spec
		}
	}
	#Regula Augustini
	option = {
		name = "L3T.7B"	
#		trigger = {
#			any_demesne_title = {
#				location = {
#					is_catholic_group = yes
#				}
#			}
#		}
		random_demesne_title = {
			limit = {
				tier = baron
				holding_type = temple
				has_building = MONASTERE
				NOT = {
					has_building = REGLE_DE_1
					has_building = REGLE_DE_2				
					#has_building = REGLE_DE_3
				}
			}
			add_building = REGLE_DE_2
			clear_event_target = holding_to_spec
		}
	}
}
	#Regula Basili #given by L3T.6
#	option = {
#		name = "L3T.7C"	
#		trigger = {
#			any_demesne_title = {
#				location = {
#					OR = {
#						religion = orthodox
#						is_heresy_of = orthodox
#					}
#				}
#			}
#		}
#		random_demesne_title = {
#			limit = {
#				tier = baron
#				holding_type = temple
#				has_building = MONASTERE
#				NOT = {
#					has_building = REGLE_DE_1
#					has_building = REGLE_DE_2				
#					has_building = REGLE_DE_3
#				}
#			}
#			add_building = REGLE_DE_3 #saint-Basile
#			clear_event_target = holding_to_spec
#		}
#	}
#}

# Init built holding (on_action)
# ROOT = Builder, FROM = Title
character_event = {
	id = L3T.9
	hide_window = yes
	is_triggered_only = yes 
	
	immediate = {
		if = {
			limit = { FROM = { holding_type = castle } }
			narrative_event = { id = L3T.3 days = 1 }
		}
		if = {
			limit = { FROM = { holding_type = city } }
			narrative_event = { id = L3T.4 days = 1 }
		}
		if = {
			limit = { FROM = { holding_type = temple } }
			narrative_event = { id = L3T.6 days = 1 }
		}
	}
}